\documentclass[specification,annotation]{itmo-student-thesis}

%% Опции пакета:
%% - specification - если есть, генерируется задание, иначе не генерируется
%% - annotation - если есть, генерируется аннотация, иначе не генерируется
%% - times - делает все шрифтом Times New Roman, требует пакета pscyr.

%% Делает запятую в формулах более интеллектуальной, например: 
%% $1,5x$ будет читаться как полтора икса, а не один запятая пять иксов. 
%% Однако если написать $1, 5x$, то все будет как прежде.
\usepackage{icomma}

%% Данные пакеты необязательны к использованию в бакалаврских/магистерских
%% Они нужны для иллюстративных целей
%% Начало
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{filecontents}
%%\begin{filecontents}{bachelor-thesis.bib}
%%\end{filecontents}
%% Конец

%% Указываем файл с библиографией.
\addbibresource{bachelor-thesis.bib}

\begin{document}

\studygroup{M3436}
\title{Реализация эффективного взаимодействия между платформой для анализа экспрессии генов Morpheus и библиотекой вычислительных методов R/Bioconductor}
\author{Зенкова Дарья Михайловна}{Зенкова Д.М.}
\supervisor{Сергушичев Алексей Александрович}{Сергушичев А.А.}{канд. техн. наук}{программист кафедры информационных систем}
\publishyear{2017}
%% Дата выдачи задания. Можно не указывать, тогда надо будет заполнить от руки.
\startdate{01}{сентября}{2016}
%% Срок сдачи студентом работы. Можно не указывать, тогда надо будет заполнить от руки.
\finishdate{31}{мая}{2017}
%% Дата защиты. Можно не указывать, тогда надо будет заполнить от руки.
%% \defencedate{15}{июня}{2015}

%% Задание
%%% Техническое задание и исходные данные к работе
\technicalspec{Разработать веб-приложение для анализа экспрессии генов, интегрирующее возможности визуального анализа morpheus.js и методы анализа библиотек R/Bioconductor. Веб-приложение должно быть легко дополняемо новыми методами для исследования и анализа экспрессии генов.}

%%% Содержание выпускной квалификационной работы (перечень подлежащих разработке вопросов)
\plannedcontents{\begin{enumerate}
    \item Обзор предметной области		
    \item Архитектура проекта		
    \item Практическая реализация и результаты
\end{enumerate}}

%%% Исходные материалы и пособия 
\plannedsources{\begin{enumerate}
    \item Joshua Gould. Morpheus.js. JavaScript matrix visualization and analysis. [Электронный ресурс]. URL: https://github.com/cmap/morpheus.js/;
    \item Arora Sonali, Carlson Marc, Hayden Nate [и др.]. Bioconductor is an open source, open development software project to provide tools for the analysis and comprehension of high-thoughput genomic data. [Электронный ресурс]. URL: https://www.bioconductor.org/;
    \item Ooms Jeroen. OpenCPU is a system for embedded scientific computing and reproducible research. [Электронный ресурс]. URL: https://www.opencpu.org/;
    \item Docker. Docker is the software container platform. [Электронный ресурс]. URL: https://www.docker.com/;
\end{enumerate}}

%%% Календарный план
\addstage{Ознакомление с предметной областью}{30.09.2016}
\addstage{Изучение исходного кода morpheus.js}{31.10.2016}
\addstage{Проектирование метода взаимодействия}{30.11.2016}
\addstage{Внедрение и тестирование нового функционала}{31.03.2017}
\addstage{Запуск веб-приложения в публичное пользование}{28.04.2017}
\addstage{Обработка результатов, написание пояснительной записки}{31.05.2017}

%%% Цель исследования
\researchaim{Создать веб-приложение, интегрирующее существующие возможности веб-приложения morpheus.js и методы анализа, реализованные в Bioconductor.}

%%% Задачи, решаемые в ВКР
\researchtargets{\begin{enumerate}
    \item разработка способа взаимодействия между js-клиентом и R и встраивание его в morpheus.js;
    \item создание графического интерфейса в js-клиенте и серверной реализации в R-пакете;
    \item объединение всех составляющих в единое веб-приложение phantasus;
    \item запуск веб-приложения в открытый доступ для исследователей.
\end{enumerate}}

%%% Использование современных пакетов компьютерных программ и технологий
\advancedtechnologyusage{Были использованы следующие программы и технологии: язык программирования JavaScript, фреймворк Node.js, веб-приложение morpheus.js, язык программирования R, библиотека биоинформатических алгоритмов Bioconductor, система интеграции R OpenCPU, механизм для сериализации данных Protocol Buffers, репозитория геномных данных Gene Expression Omnibus, программное обеспечение для запуска приложений в контейнерах Docker, веб-сервер Apache, среда разработки WebStorm, среда разработки RStudio, система контроля версий git, система компьютерной верстки \LaTeX.}

%%% Краткая характеристика полученных результатов 
\researchsummary{Реализовано веб-приложение phantasus, отвечающее всем поставленым требованиям. Веб-приложение было запущено в публичный доступ, используется в лаборатории Максима Артемова в Washington University in St. Louis. Демонстрация приложения входит в программу семинара по системной биологии в Сиднее (10-13 апреля 2017) и в Санкт-Петербурге (14-19 мая 2017).}

%%% Гранты, полученные при выполнении работы 
\researchfunding{Работа над данной инженерной разработкой велась без поддержки грантами.}

%%% Наличие публикаций и выступлений на конференциях по теме выпускной работы
\researchpublications{По данной инженерной разработке не имеется публикаций и она не была представлена на конференциях.
}

%% Эта команда генерирует титульный лист и аннотацию.
\maketitle{Бакалавр}

%% Оглавление
\tableofcontents

%% Макрос для введения. Совместим со старым стилевиком.
\startprefacepage

В данном разделе размещается введение.

%% Начало содержательной части.
\chapter{Обзор предметной области}

\section{Биоинформатика}

\textbf{Биоинформатика} --- наука, объединяющая в себе методы прикладной математики, статистики, информатики для создания новых методов и алгоритмов для анализа разного рода биологических данных.

Биоинформатика занимается биохимией, биофизикой, экологией и многими другими областями биологии. Однако в данной работе фокус направлен на геномную биоинформатику и на конкретную ее задачу --- анализ экспрессии генов.

\subsection{Анализ экспрессии генов}
\textbf{Экспрессия генов} --- процесс преобразования наследственной информации от гена (в виде последовательности нуклеотидов ДНК) в функциональный продукт (РНК или белок).

Анализ экспрессии генов позволяет выяснить как ведет себя отдельный ген в разных условиях, тканях или организмах.
Так, например, можно исследовать экспрессию вирусных белков или экспрессию онкогенов.

\subsection{Используемые методы}
Как было сказано ранее, биоинформатика использует в себе математику, информатику и статистику. Соответственно, задача анализа экспрессии генов сводится к исследованию путем статистических методов и алгоритмов числовой двумерной матрицы, как, например, небольшой срез матрицы в таблице \ref{matrix}.

\begin{table}[!h]
\caption{Срез матрицы GSE14308. Строки матрицы соответствуют генам, столбцы --- образцам.}\label{matrix}
\centering
\begin{tabu}{|r|*{6}{c|}}
\hline
       & GSM357839	& GSM357841	& GSM357842	& GSM357843	& GSM357844	 \\\hline
Rps29	 & 16.32	    & 16.30	    & 16.25	    & 16.32	    & 16.30	     \\\hline
Rpl13a & 16.27	    & 16.23	    & 16.32	    & 16.30	    & 16.27	     \\\hline
Rps3a1 & 16.23	    & 16.19	    & 16.30	    & 16.25	    & 16.25	     \\\hline
Rpl38	 & 16.21	    & 16.25	    & 16.27	    & 16.27	    & 16.21	     \\\hline
Tmsb4x & 16.30	    & 16.32	    & 16.23	    & 16.21	    & 16.32	     \\\hline
\end{tabu}
\end{table}

На рисунке можно увидеть визуализацию матрицы экспрессии в виде тепловой карты.

Также к основным методам анализа относятся:
\begin{itemize}
\item Иерархическая и вероятностная кластеризации;
\item Дифференциальная экспрессия;
\item Метод главных компонент и визуализация его результатов.
\end{itemize}

\section{Существующие решения для анализа экспрессии генов}
\subsection{R/Bioconductor}
\textbf{R} - язык программирования для статистического анализа данных и работы с графикой \cite{rproject}.

\textbf{Bioconductor} - библиотека, содержащая в себе множество реализаций биоинформатических алгоритмов и методов обработки биологических данных на R. Она постоянно обновляется, пополняется новыми библиотеками, модерируется сообществом \cite{bioconductor}.
R и Bioconductor очень популярны в биоинформатической среде ввиду предоставляемых возможностей.

Однако для качественного и полноценного анализа с помощью этих инструментов, нужно иметь навыки программирования на R, что весьма неудобно для исследователей биологических специальностей.

\subsection{GENE-E}
\textbf{GENE-E} - Платформа для анализа данных и визуального исследования данных, созданная на Java и R \cite{genee}. Содержит в себе множество полезных для исследования инструментов: тепловые карты, кластеризацию, фильтрацию, построение графиков и т.д. Позволяет исследовать любые данные в виде матрицы. К тому же, содержит дополнительные инструменты для геномных данных.

Недостатки:
\begin{itemize}
\item Чтобы использовать, необходимо устанавливать на свой компьютер;
\item Поддержка данного приложения прекратилась в связи с созданием morpheus.js \cite{morpheus};
\item Не имеет открытого исходного кода, а только API для взаимодействия и создания новых приложений на его основе.
\end{itemize}

\subsection{morpheus.js}
\textbf{Morpheus.js} - веб-приложение для визуализации и анализа матриц от создателя GENE-E \cite{morpheus}. Создано уже на JavaScript и с открытым исходным кодом. Удобно для использования исследователями без навыков программирования и так же, как и GENE-E, применимо к любым матрицам.

Недостатки:
\begin{itemize}
\item Ограниченный набор функций, которых недостаточно для полноценного анализа;
\item Для расширения биоинформатическими алгоритмами, не прибегая к дополнительным инструментам, требуется реализовывать их заново на JavaScript.
\end{itemize}

\section{Инструменты, которые могут быть применены}
\subsection{Язык R и библиотека Bioconductor}
Как было сказано ранее, Bioconductor полон актуальными и широко используемыми биоинформатическими алгоритмами, в том числе и для анализа экспрессии генов. Соответственно, реализовывать их заново обычно нет необходимости и можно использовать их для достижения целей этой работы.

\subsection{JavaScript и Node.js}
\textbf{JavaScript} --- мультипарадигменный скриптов язык программирования, широко используемый для создания веб-приложений.

\textbf{Node.js} --- \cite{nodejs}

\subsection{R shiny}
\subsection{OpenCPU}
\subsubsection{Необходимые определения}
HTTP
HTTP API
RPC
Веб-сервер

\textbf{OpenCPU} --- система для встроенных научных вычислений и воспроизводимых исследований, предоставляющая HTTP API для взаимодействия с R-серверами \cite{opencpu}.

Имеется также библиотека \textit{opencpu.js} для интеграции JavaScript и R.

\subsection{Gene Expression Omnibus}
\textbf{Gene Expression Omnibus (GEO)} --- международный публичный репозиторий, агрегирующий и распространяющий различные формы геномных данных от исследовательского сообщества \cite{geo}.

В библиотеке Bioconductor есть R-пакет \textit{GEOquery} для удобной загрузки данных из GEO \cite{geoquery}.

\subsection{Docker}
\textbf{Docker} --- программное обеспечение для автоматизации запуска и внедрения приложений внутри контейнеров \cite{docker}.

Для дальнейшего описания данного инструмента введем несколько определений.

\textit{Образ} --- отдельный исполняемый пакет, включающий себя все необходимое для запуска единицы программного обеспечения, в том числе исходный код, библиотеки, переменные окружения, конфигурационные файлы. Зачастую образ построен на основе другого образа с дополнительной конфигураций. Образ компилируется по \textit{Dockerfile}, каждая команда в котором соответствует новому слою. При перекомпиляции обновляются только те слои, которые изменились. 

\textit{Контейнер} --- запущенный экземпляр образа. Контейнер обычно исполняется изолированно от окружения, имея доступ к файлам или портам хост-системы только при наличии соответствующей конфигурации.

В отличие от виртуальных машин, которые запускают гостевую операционную систему в каждом экземпляре, контейнеры могут разделять общее ядро, и вся информация, которая должна быть в контейнере, это исполняемый процесс и его зависимости. Исполняемые процессы из контейнеров работают как нативные процессы, и могут управляться по отдельности. 

Для контроля версий и хранения образов в открытом доступе используется Docker Hub \cite{dhub}. В этом хранилище можно как добавлять репозитории, управляемые вручную, так и поддерживать автоматические сборки (\textit{Automated Build}), которые привязаны к репозиториям на в популярных системах контроля версий: GitHub \cite{github} и Bitbucket \cite{bitbucket}.

\subsection{JSON}
\subsection{Protocol Buffers}
\textbf{Protocol Buffers (Protobuf)} --- гибкий, универсальный и автоматизированный механизм для сериализации структурированных данных \cite{protobuf}.

Структура информации задается с помощью \texttt{*.proto} файлов в форме сообщений (Message).

\subsection{Apache}
\subsection{HTML}

\section{Постановка задачи}
Рассмотрев существующие решения для анализа экспрессии генов и инструментов, которые могли бы пригодиться для будущих решений, можно сформулировать цель и основные задачи данной работы

\subsection{Цель работы}
Создать веб-приложение, интегрирующее существующие возможности веб-приложения morpheus.js и методы анализа, реализованные в Bioconductor.

\subsection{Основные задачи}
\begin{enumerate}
\item Разработать способ взаимодействия между js-клиентом и R и встроить его в morpheus.js, чтобы избежать реализации с нуля уже существующих алгоритмов;
\item Реализовать графический интерфейс в js-клиенте и серверную реализацию в R-пакете;
\item Соединить все составляющие в одном веб-приложении phantasus;
\item Запустить веб-приложение в открытый доступ для исследователей.
\end{enumerate}

\subsection{Требования к веб-приложению phantasus}
\subsubsection{Доступность}
Необходимо, чтобы веб-приложение phantasus было доступно для исследователей независимо от их местоположения и времени суток. Варианты действий:

\begin{enumerate}
\item Сделать его доступным по определенному веб-адресу, и тогда пользователь сможет продолжать исследования из любой точки, где есть подключение к интернету;
\item Предоставить возможность запускать приложение локально, например, с помощью Docker или внутри R.
\end{enumerate}

\subsubsection{Возможность дальнейшего расширения функционала}
Как уже было сказано выше, библиотека Bioconductor постоянно обновляется и пополняется новыми алгоритмами, а исследователи находят новые методы для анализа экспресси генов, так что необходимо не только реализовать дополнительные методы, но и отладить и описать алгоритм действий для добабления новых.

\chapterconclusion

\chapter{Архитектура проекта phantasus}
В этой главе будут подробно рассмотрены составляющие проекта:
\begin{itemize}
\item morpheus.js;
\item R-пакет phantasus;
\item OpenCPU.
\end{itemize}
Также будут описаны взаимосвязи между компонентами, сопутствующие инструменты и их предназначение в системе и ключевые для архитектуры выдержки из исходного кода.

\section{morpheus.js}
Как уже было рассказано в обзоре, morpheus.js --- веб-приложение, полностью созданное на JavaScript, для визуализации и анализа матриц.

В этом разделе будут описаны основные классы и функции, реализованные в исходном коде morpheus.js, которые будут в дальнейшем необходимы для расширения функционала.

\subsection{Чтение данных}
В morpheus.js данные могут быть загружены из файла, полученного одним из следующих путей:
\begin{itemize}
\item Из компьютера;
\item По URL-ссылке;
\item Из Dropbox.
\end{itemize}

Допустимые форматы загружаемых файлов:
\begin{itemize}
\item txt-файл с tab-разделителями;
\item Excel-таблица;
\item MAF \cite{maf};
\item GCT \cite{gct};
\item GMT \cite{gmt}.
\end{itemize}

Для каждого формата файла в исходном коде morpheus.js присутствует соответствующий обработчик данных.

Также, morpheus.js предлагает набор предзагруженных данных из базы TCGA \cite{tcga}.

\subsection{Класс Dataset}
Одним из ключевых классов всего веб-приложения является класс Dataset. В каждом экземпляре этого класса хранится вся необходимая информация о данных, в которую входят:

\begin{itemize}
\item Числовая матрица, характеризующая уровень экспрессии всех генов во всех образцах;
\item Количество строк и столбцов в матрице;
\item Аннотация к образцам, например:\begin{itemize}
    \item пол, возраст, контактную информацию испытуемых, если образцы были взяты с людей;
    \item есть или нет инфекция в данном образце;
    \item способ лечения;
    \item контакты ответственного за взятие данного образца и пр.;\end{itemize}
\item Аннотация к генам, например:\begin{itemize}
    \item Идентификатор гена в том или ином стандарте;
    \item Числовые характеристики гена (средний уровень экспрессии по образцам, номер кластера) и пр.\end{itemize}
\end{itemize}

Аннотация реализована в классе MetadataModel, который представляет собой не что иное, как набор именованных векторов с характеристиками. В каждом векторе хранятся:

\begin{itemize}
\item Название;
\item Формат (строка, число);
\item Массив значений.
\end{itemize}

Для векторов так же предусмотрены утилиты для визуализации. Так, например, есть возможность показать аннотацию в виде текста и/или цветом, что удобно для категориальных характеристик. 

\subsection{Класс SlicedDatasetView}
Чаще всего во время работы программы экземпляры класса Dataset становятся обернуты в оболочку из SlicedDatasetView. Этот дополнительный класс дает возможность не пересоздавать каждый раз Dataset, а просто добавляет к данным информацию о том, какие индексы строк и столбцов выбраны и используются в данный момент.

\subsection{Класс HeatMap}
Данный класс предназначен для визуализации данных, обернутых в класс Dataset или SlicedDatasetView. Он дает возможность выбирать, какая аннотация будет представлена на экране, цветовой код, выбирать строки и столбцы, с которыми будут работать те или иные инструменты.

\subsection{Реализованные методы}
В morpheus.js имеются реализации следующих методов:

\begin{itemize}
\item Adjust --- инструмент для корректировки данных:\begin{itemize}
    \item $\log_{2}$;
    \item $\log_{2}^{-1}$;
    \item Квантиль-нормализация;
    \item Z-тест;
    \item Устойчивый Z-тест;\end{itemize}
\item Collapse --- инструмент, позволяющий агрегировать строки или столбцы с одинаковыми значениями с помощью функции: $min$, $max$, $mean$, $median$, $sum$, максимум 25-го и 75-го перцентилей;
\item Создать вычисленную аннотацию для строк или столбцов;
\item Similarity Matrix;
\item Transpose;
\item t-SNE;
\item Построение графиков.
\end{itemize}

Также присутствуют фильтрация и сортировка. 

\section{phantasus.js}
В этом разделе будет рассмотрен модифицированный вариант morpheus.js и потребовавшиеся для его расширения компоненты.
\subsection{Клиентская сторона OpenCPU --- opencpu.js}
В обзоре было рассказано об OpenCPU и его необходимости. В данной работе он нужен для связи JavaScript-клиента и R-сервера.
\subsection{Поддержка Protocol Buffers --- protobuf.js}
\subsection{Интерактивные графики --- plotly.js}

\section{R-пакет phantasus}
Весь реализованный функционал должен иметь клиентскую часть в виде графического интерфейса и серверную в виде R-функции.
Прежде чем рассматривать созданные функции, будут представлены имеющиеся необходимые элементы.

\subsection{Biobase и ExpressionSet}
\subsection{Загрузка данных из GEO --- GEOquery}
\subsection{Дифференциальная экспрессия --- limma}
\subsection{Статистические функции --- stats}
\subsection{Поддержка Protocol Buffers --- protolite}

\section{Связь через OpenCPU API}

\section{Неотсортировано}

\chapterconclusion

\chapter{Реализация}

\chapterconclusion

%% Макрос для заключения. Совместим со старым стилевиком.
\startconclusionpage

В данном разделе размещается заключение.

\printmainbibliography

%% После этой команды chapter будет генерировать приложения, нумерованные русскими буквами.
%% \startappendices из старого стилевика будет делать то же самое
\appendix


\end{document}
